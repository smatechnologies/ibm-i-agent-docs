---
sidebar_label: 'Version 18.1 New Features'
---

# Version 18.1 New Features

This list shows the enhancements that were added to the OpCon Agent for IBM i as LSAM version 18.1 was released, available only after upgrading to version 18.1, plus several enhancements that have been added to this Agent version during its lifecycle.

Some of these enhancements were introduced as part of the new Agent version, so they do not appear in the Version 18.1 Fixes list that shows all LSAM PTFs.  On the other hand, some of the enhancements listed here will also appear in the Fixes list as part of the serial list that is sorted by the LSAM PTF Number.

| Enhancements | Description |
| ------------ | ----------- |
| Table note: |Where applicable, an LSAM PTF name will be shown as a number (181000) in the Description field.|
| IBMI-41 |The IBM i LSAM communication with the OpCon server and with other Agents can now be optionally encrypted with TLS Security.|
| IBMI-44, IBMI-316 | The IBM i LSAM Operator Replay green screen workstation robotic automation feature now supports (1) user-defined selection of virtual display devices according to four different algorithms, and (2) more flexibility for designating the Operator Replay Script job User Profile, including relying on the OpCon Job Master User Name, just as for standard IBM i Batch Jobs. |
| IBMI-292, IBMI-318 |The IBM i LSAM reporting of Detail Job Messages to each OpCon job’s Information panels is further enhanced with more messages and more helpful information for diagnosing job failures without having to investigate the IBM i LSAM logs in every case. The LSAM command SMAJOBMSG is made more flexible with a JOB( ) parameter, so that it can be used by features such as Message Management. |
| IBMI-330 |The IBM i LSAM simple FTP Job subtype among the OpCon job masters now supports extensions to the Remote System Address field, allowing the parameters of the IBM i “FTP” command to be specified. This supports identifying non-standard FTP Port Numbers at the remote site, and it may also possibly be used to engage secured FTP connections (given that the user is responsible for all system requirements of secured connections, such as digital certificate management and any other IBM i configuration options).|
| IBMI-355 | The IBM i LSAM implementation of SMA File Transfer now supports an LSAM Network Address Translation table that enables using SMA File Transfer within a virtual IBM i partition (such as when a Client LPAR is served by the physical IP connections of a Host LPAR, and address-forwarding services are configured between the Host and its Client LPARs).|
| IBMI-363 |The IBM i LSAM Message Management Parameters definition now better supports long Event (or IBM i) command lines. |
| IBMI-366 |The IBM i LSAM Dynamic Variables get another new Function Code called *HEX, used, for example, when inserting text formatting characters into OpCon Event commands such as email message texts. The Agent User Help is also greatly improved by the addition of a whole new chapter dedicated to all the features of the Dynamic Variables. Parts of this tool were removed from everywhere else in the documentation and consolidated into one, easy to locate reference. |
| IBMI-394 | The IBM i LSAM PTF (software patching) tools are enhanced with (1) a new “PTF Level” that independently identifies the authoritative software level of the Agent, avoiding confusion among “PTF Names” that appear out of sequence because of their required “application Sequence Number”; and (2) a new “DB Level” (database level) that greatly relaxes the constraints between two different LSAM environments when the LSAM Data Export/Import tool is used to exchange automation tool configurations and scripts.|
| IBMI-397, IBMI-446 |The IBM i LSAM communication programs have finally eliminated any possibility of the occasional “address already in use” error.|
| IBMI-406 |The IBM i LSAM communication with the OpCon server can now optionally filter connection requests according to a user-defined list of one to four allowed IP Addresses. In addition, any attempt by more than one OpCon server to connect to the same LSAM will be rejected, while the incident will be reported to both the original OpCon SAM Log as well as to the IBM i partition’s QSYSOPR message queue. When second connect attempts are rejected, the original OpCon server connection will be preserved active. |
| IBMI-413 |The IBM i LSAM Message Management feature now supports a user-selected option for governing the order in which Parameter records are executed. This improves the flexibility of using multiple Parameter records (each with a different Sequence Number) to implement more elaborate message response routines.|
| IBMI-415, IBMI-459 |The IBM i LSAM SCANSPLF utility, as well as the Dynamic Variables, are now enhanced with new capabilities for preserving and counting either leading or trailing spaces. The previous default method of always trimming spaces from a character string can still be used, but new options allow for keeping either or both of any leading spaces or any trailing spaces. This prevents, for example, false matches when a short comparison string is found within a much longer string, just because the short string surrounding spaces were not being taken into consideration. |
| IBMI-500 |(181027) The IBM i LSAM environment audit/fix utility program, LSASETENVC, is enhanced with an extra step that checks for the job queue named SMALSAQ00 which is used to start the LSAM server jobs.  Although this job queue is normally saved and restored by IBM commands, so that the original object distribution from SMA is preserved, in case this object is lost accidentally, the Agent install/upgrade command SMASETUP, or the LSAM Environment audit command LSAINIT, will each restore the job queue if it is missing.|
| IBMI-501 |(181029, 181030) The IBM i LSAM SCANSPLF and SCANOUTQ utilities are updated with a new search/filter field that refers to values of the User-Defined Data field (255 characters long) among the spool file attributes. At the same time, the LSAM menu system program for maintaining Scan Rules has been revised with an optional 2-page display format that should make it easier to view and understand the array of Scan Rule options. The default view (1-page or 2-page) can be set using the LSAM sub-menu 3: Utilities, option 7:  Configuration.|
| IBMI-502 |(181045) The IBM i LSAM Operator Replay feature is enhanced with an option to support TLS Security when accessing the IBM i Telnet Server, implementing a secure connection between the Operator Replay Script driver and the virtual workstation.|
| IBMI-508 |(181033) The IBM i LSAM Dynamic Variables will now allow nested Dynamic Variable {TOKENS} in the VALUE field of a numeric variable. The Work with Dynamic Variables function now supports function key F8=DynVar in the Add/Change/Copy maintenance display, making it easier to select and insert a correctly spelled variable token name. |
| IBMI-510 |(181034, 181035) The SCANSPLF command can now send both progress information messages and error messages to the IBM i job log, in addition to sending them to the optional LSAM application log file.  This option is active by default, but it can be controlled by the new JOBLOGMSG parameter that has been added to the SCANSPLF command.  The LSAM server job LSAJOR executes the SCANSPLF command when it is requested by an extended Call command line in an OpCon IBM i batch job.  To prevent excessive jog logging of the never-ending LSAM server job LSAJOR, there is now a control option added to LSAM sub-menu 3, option 7, where the job log messages from the SCANSPLF can be turned off.  Even so, if a Call command line extension SCANSPLF command includes the JOBLOGMSG(Y) or JOBLOGMSG(1) parameter, this will override the LSAM general control option, but just for this one execution of the command.|
| IBMI-511 |(181036) As a result of the FIX, it is now possible to insert 1 or more spaces into a string wherever a {TOKEN} is replaced, using a Dynamic Variable that has a blank value, or one that results in all blanks after nested {TOKENS} are replaced.  For example, a token named {BLANK4} could use the Character Trim Start (1) and Length (4) to enforce insertion of four space characters. Thus, it is also now possible to compare a captured value or another Dynamic Variable to a Reference Dynamic Variable that contains all blanks. Numeric Dynamic Variables will now return a zero (subjected to any numeric editing rules) whenever the current value of a numeric Dynamic Variable is all blanks.|
| IBMI-517 |(181039) A new $-System system-defined variable is supported by the IBM i LSAM in Response Rules associated with green screen Capture Data rules (that are connected to Operator Replay Script Steps).  The variable $SCRIPT USER returns the IBM i User Profile name that was used to login to the green screen workstation, and so it is also the virtual workstation interactive job User name.  The PTF Post-Install instructions provide some additional background information and hints about User names associated with Operator Replay jobs.|
| IBMI-526 |(181047) The IBM i LSAM File Arrival job commands (CHKFILE and CHKIFSFIL) have been enhanced with improved library list management.  Use the ENV( ) and GPL( ) parameters to specify the LSAM environment whenever these commands are used from outside of the LSAM environment; the commands themselves must be qualified with their library location: SMAPGM/.  The CHKIFSFIL command programs will now use a permanent DB2 work library instead of QTEMP to receive the file list and error report from the IFS file search sub-program.  The work library will be deleted at the successful end of the command or if a command parameter says to end normally in spite of errors.  When the command may otherwise report a failure (file not found, etc.), the work library will be retained.  Work libraries will be purged periodically by the LSAM daily file maintenance server job.|
| IBM-529 |(181053) The IBM i LSAM TLS Security configuration functions for Job Scheduling (and JORS) and the SMA File Transfer functions is changed so that the LSAM no longer stores or forces certification validation option settings into the IBM Digital Certificate Manager database.  The screen formats now show summary advice that the IBM DCM must be used to manage those options.  This improves system security strategies.|
| IBMI-530 |(181054, 181055) The IBM i LSAM Dynamic Variables that use the *SYSVAL Function Code must now store a valid IBM i System Value Name in the Function Code Field 2 (which is alternately used for a user-defined Value Calculator program library name).  The LSAM still supports the former standard that forced the Token Name to be a System Value name, but any Change action will enforce the new rule.  This change makes system value retrieval more flexible, allowing for different formatting rules for the same system value.  [Small documentation changes will be published in future editions of the OpCon User Help.  Meanwhile, the F1=Help feature in the LSAM Dynamic Variable maintenance program explains the new standards.|
| IBMI-534 |(181051) The IBM i LSAM File Arrival job command for IFS file searches has its search sub-program changed to remove the LEVEL(\*JOB) environment variables that it uses during a file search, in order to avoid leaving behind a conflict with any similar LEVEL(\*SYS) environment variable.|
| IBMI-535 |(181056) The IBM i LSAM communication log file now masks the password of the External Event command user profile. Also, the LSAM pending transactions log (file CMNLOGF10) will mask the External Event command user password immediately after the transaction is confirmed sent, as the transaction is being updated with its “sent” code.  This file should be kept secure, as when it is originally installed, to prevent unauthorized users from possibly viewing a clear text password in the rare case that a transaction transmission is interrupted by a failure of the LSAM communications program.|
| IBMI-545 |(181062) The IBM i LSAM Multi-Step Job Script log display from option 6 on LSAM sub-menu 5 now uses a standard LSAM list and filter display program, replacing the simple IBM i DSPPFM command.  See the Post-Install instructions for a summary of the new list options and function keys that help navigate the log entries.  This log display shows only the Script Step execution entries which are also included in the IBM i job log of each Script execution, but the LSAM’s own log of the Script execution steps may survive longer than individual IBM i job log reports.|
| IBMI-546 |(181063) The IBM i LSAM Management sub-menu 6, option 5=Log viewers, Log viewer 4 has been updated with a new log file display program that is much easier to read and navigate.  Please read the Post-install Instructions for hints about ways to use the new features.|
| IBMI-549 |(181066, 181067) The IBM i LSAM SCANSPLF command is enhanced with a new parameter SCANCOND (Scan Condition) that is used to control the way the LSAM Job Completion Status server program uses the SCANSPLF command to override the final job status reported to OpCon.  This new parameter adds the option to override Failed jobs, whereas previously the SCANSPLF command appended to the Call command line of an OpCon IBM i Batch Job could only be used if the primary Call command completed normally.  This enhancement will sometimes be more effective or flexible than using the CMDEXE2 wrapper command to bypass low-level errors and allow a job to be reported as completed normally.|
| IBMI-554 |(181069) The IBM i LSAM Multi-Step Job Script driver feature has been enhanced.  The Script driver program has been improved to behave more exactly like the existing documentation with regard to the use of the ON-ERROR and ON-RESTART special labels.  It also now accepts either an underscore character (ON_ERROR) or a dash (ON-ERROR) for both the ERROR and RESTART special labels, as documented.  It is now possible to execute the SMAGOTO pseudo command directly from either an ON-ERROR or an ON-RESTART labelled command line (whereas before, it was necessary to use a sub-script via STRMLTJOB or SMASUBR to utilize the SMAGOTO command).  The Script driver now performs more pervasive loop prevention logic. The loop prevention helps to avoid step looping that could occur when the SMAGOTO command is used in an ON-ERROR step that points back to the original failing step. To support this logic, the maximum allowed loops can be updated using a new menu option in LSAM sub-menu 5, where menu option 7 now supports Script Utility Configuration, and the former option 7 now becomes option 9: Maintain Dynamic Variables.|
| IBMI-567 |(181081) Two IBM i LSAM log file viewers are enahanced or fixed.  The Submitted Job Log now supports function key F5=Subset to Select or Omit entries from the list according to the TYP column value.  The LSAM Job Master log display has the Search function fixed to continue into subsequent pages of the list, and also to allow the PageDown key after using F11 to change the sort order.|
| IBMI-570 |(181082) The LSAM Job Scheduler communications program is enhanced to improve automatic recovery after an abnormal disconnect and to better manage no ACK response.  Both the communications program and the job submitting program have improved trace debug logging.|
| IBMI-571 |(181085, 181086) A new utility command is added to the IBM i LSAM software suite.  Command SMAPGM/DLTIFSFIL provides a flexible utility for deleting aged files from IFS file systems outside of DB2, including the ‘/’ root file system and /QOpenSys.  Please review the Post-Install instructions for a summary of the capabilities of this command and an explanation of the command parameters. **NOTE:** This first version of this command requires that the LSAM library list be set – it does not change the library list itself.  The LSAM Wrapper command “LSAMCMD” can be used to select and manage a job’s library list for only as long as this DLTIFSFIL command is executing, and then remove the LSAM libraries from the job library list.|
| IBMI-574 |(181091, 181092) Enables the IBM i LSAM to support the new External Token encrypted security code that is generated by the OpCon User Interface for Users who are authorized to submit External Event commands to the OpCon server.  The IBM i LSAM External Event Password storage function has been merged into a special format of the general LSAM User Maintenance, although the External Event Token maintenance access remains located in LSAM sub-menu 3, option 2.  The LSAM now stores the External Event Token (or older Password) in a more secure IBM i Validation List.|
| IBMI-576 |(181088) The IBM i LSAM software analysis utility command DSPOBJWU now supports a generic file NAME\*, useful only for file names.  This allows a single list of programs to show all references to a physical file and all of its logical files.  For example, try this: DSPOBJWU  LSAJOBF1\* \*FILE.|
| IBMI536, IBMI-578 |(181087, 181090) A new set of LSAM file maintenance commands are added to enable automatic maintenance of the Agent’s Job Tracking parameters master file, and also of the Multi-Step Job Scripts and Steps master files.|
| IBMI-583 |(181094) The IBM i LSAM PTF List display now shows the PTF Level and the DB Level in the left-most columns of the list display.  This change helps to call attention to the change in this LSAM from an older release, where the “PTF Name field” (such as “PTF181094”) is no longer the controlling number for the current patch level of the LSAM software.  Since LSAM version 18.1 was introduced, the new PTF Level field is the official patch level.  For example, this enhancement represents LSAM PTF Level 18.1.094.|
| IBMI-587 |(181093) The IBM i LSAM File Arrival jobs now always use the IBM i LSAM Parameters designated special-purpose job description for both DB2 and non-DB2 IFS file searches.  This support for a dedicated, optionally unique job description, makes it possible for users to designate their own IBM i user profile at sites where the previous default job user of SMANET was not appropriate, as well as offering an option to override other job attributes except for the Job Queue that is specified in the OpCon job master record.|
| IBMI-588 |(181095)  The LSAM Job Scheduler data communication program that is connected to the OpCon application server is improved with detection and automatic recovery (when possible) in case the data queue that connects this LSAM server job with the actual LSAM Job Scheduler service should get full.  This problem normally only occurs at some sites with a very old, original install of the LSAM software.  In some cases, depending on patch levels and the upgrade path to LSAM version 18.1, the data queue CMNINPT00 does not get upgraded from its older 16MB size to the newer standard of 2GB in size.  But sites with extremely high volumes of activity could still experience a recoverable queue-full error if the IBM i system is already extremely busy, so now the LSAM has an ability to pause and then recover from an overflow of incoming data.|
| IBMI-589 |(181096)  The IBM i File Arrival jobs that search the non-DB2 IFS file systems were generating a large number of false error messages each time a repeating file check tried to use the CLRPFM command for a file that did not already exist.  The Agent’s File Arrival job programming has been changed to avoid generating this type of message in job logs.|
| IBIM-594 |(181097)  The IBM i Agent DLTIFSFIL (Delete files from IFS file systems) command is enhanced to improve failure or completion message reporting, in support of the $ERRMSGID and $ERRMSGTXT special variables.  The command has another parameter added:  FAILNOFILE that enables user control of the command outcome when no files were found to delete.  The default value for this parameter is 0=No, do not fail, and the other option is 1=Yes, do fail if zero files were deleted.|
| IBMI-613 |(181103)  Add QPPGMDMP and QPDSPJOB SPLFs to JORS retrieval.  A new control file option also allows users to display any report produced by a job that OpCon started, but responsibility for protecting private data falls to the user of this option.|
| IBMI-714 |(181107) Expand LSAM transaction buffers. The LSAM communications program that connects to the OpCon server has its internal transaction buffer expanded from 1280 bytes to 3840 bytes. This allows for longer XML-formatted External Event commands and possible future expansions.|
| IBMI-746 |(181106) File Arrival jobs for non-DB2 IFS disk space (command CHKIFSFIL) are enhanced to return additional error codes for a file-not-found result. Client sites who have installed certain utilities, such as node.js, into their IBM i partitions might end up with a different PATH environment variable that affects which version of the "ls" (list) command is used, changing the file not found error code.|
| IBMI-775R |(181109) The LSAM User Management functions (including the Utilities menu: External Event Token maintenance = same program) have their function key legends improved.|
| IBMI-597 |(181110, 181111) The LSAM is enhanced with a whole new set of IBM i styled commands that implement an XML tagging protocol for the OpCon External Event commands.  These commands eliminate the constraints on event command content imposed by the older comma-separated-values syntax.  (See also PTF # 181112 for subsequent changes to the Client eMail feature that depended on this enhancement.)|
| IBMI-707, IBMI-708 |(181112) The Client eMail feature is updated to support simplification and improved flexibility by supporting XML External Event Commands.  Most of the complexity of the original solution for working around the limitations of the older comma-separated-values syntax for External Event commands has been removed.|
|IBMI-807 |A new, optional LSAM server job named JOBSTS is added to the Agent.  This system monitor job watches up to 25 IBM i subsystems the user may register for any jobs that are stuck in a MSGW (message wait) status.  The JOBSTS server replaces the IBM i Monitor capability that was discontinued in IBM's latest Navigator for i, which was previously documented in this Agent user help with recommended methods for linking the IBM Monitor output to the OpCon network via this Agent's Message Management feature.  The new JOBSTS server notifications are designed to be compatible with the previously recommended solutions for the interface with OpCon. 