---
sidebar_label: 'Version 18.1 Fixes'
---

# Version 18.1 Fixes

This list shows the LSAM fixes that have been added to the OpCon Agent for IBM i since LSAM version 18.1 was released.

| Fix ID | Description |
| ------ | ----------- |
| 181023 |The IBM i LSAM menu function “Display Data Capture Debug Log’ which appears on three LSAM sub-menus was sometimes showing an incorrect Capture Rule Sequence Number for the Details display of log entries applying to one of the master records that define an Application ID.|
| 181024 |The IBM i LSAM daily database maintenance job LSAMNG was failing to perform a log files save operation due to the failure of program DLTLOGR06 to commit its database updates.  That program is replaced, now using compile option COMMIT(*NONE).|
| 181025 |The IBM i LSAM Captured Data Response Rules were not being managed separately according to the type of captured data (message data, Operator Replay screen data, SCANSPLF report data).  Whenever the same Capture Application ID name was used for two different captured data types, the Response Rules from both Capture Application IDs were being processed for both applications.  This PTF updates several LSAM programs, including master file maintenance, run-time Response Rule execution and log displays, to always separate Response Rule data according to its Capture Data Type code.|
| 181026 |After PTF # 181025, the IBM i LSAM Captured Data Response Rules were not being discovered and exported for the SCANSPLF applications.  Without any Response Rules, the Dynamic Variables referenced in those Response Rules were also not exporting.|
| 181028 |The IBM i LSAM SMA File Transfer programs are fixed to prevent adding extra null characters intermittently within a stream file that is being sent from the IFS root and similar non-DB2 file systems.|
| 181031 |The IBM i LSAM SCANSPLF utility was producing a large formatted program dump report whenever the LSAM utility command SMAFAILJOB was intentionally executed by a Response Rule.  The unnecessary dump report was so big that most client sites had to respond to an error message in QSYSOPR about the QPPGMDMP spool file exceeding its maximum allowed size. The main SCANSPLFR program is now updated to properly set the internal controls that will prevent a program dump report from being produced when an intentional, programmed forced failure is being executed. (The SCANSPLF command uses a forced RPG program failure as the way to signal the OpCon server, or signal a non-OpCon job, that the predefined Application description has detected conditions that qualify for an intentional failure.)|
| 181032 |The IBM i LSAM SMA File Transfer programs fix # 181028 is extended to prevent rare errors when reading a disk file for transmission from the IFS root and similar (non-DB2) file systems.|
| 181033 |(1) Message Management Capture rules would cause a failure if the “Length of data string” size combined with the Start Position was greater than the maximum program work field size of 1920; (2) The Operator Replay screen image log viewer was not maintaining its subfile display position after using function keys F19/F20 to shift the displayed image Left/Right; (3) the Dynamic Variable {TOKEN} replacement module would get stuck in a loop if an unregistered variable name was inserted in a nested {TOKEN}.|
| 181034, 181035 |The IBM i LSAM SCANSPLF command is fixed to properly locate the *LAST spool file produced by a job.  Previously, if a job created multiple spool files of different names, using *LAST would be confused with the very last spool file produced by the job, even if the spool  file name did not match.  Now only the last spool file with a matching name will be selected for processing. 
| 181036 |The IBM i LSAM Dynamic Variables were not always preserving leading or trailing spaces when replacing a {TOKEN}.  Now, leading or trailing spaces are more strictly enforced, according to the rules in F1=Help (for Work with Dynamic Variables) and the Administration guide.|
| 181037 |The IBM i LSAM Job Track Log Detail display format function keys were failing because they were using the wrong User ID.  For Queued Jobs, the actual job user can be overridden by OpCon, so the original SBMJOB user might be replaced.  The correction now shows both User values on the display, but it uses only the final User ID for the WRKJOB and RLSJOB function keys.|
| 181038 |The IBM i LSAM job scheduling management would leave an OpCon job stuck in “still waiting” status in high volume IBM i partitions.  This symptom appears in partitions that process more than 1,000,000 jobs in fewer than the number of days set in the LSAM daily log purge controls (in the LSAM Parameters).  The underlying cause was that the IBM i Job Number would repeat after every 999,999 jobs.  The Agent was previously finding an older OpCon job ID instead of the most current OpCon job ID.  This LSAM PTF is a temporary fix for most of the problems related to duplicate IBM job IDs.  A permanent, pervasive enhancement is already in production at SMA, but it is not immediately available.  Meanwhile, this temporary PTF # 181038 should prevent the reported problem of jobs getting stuck in “still waiting” status.  Clients who believe they have experienced other, related problems with duplicate job IDs are requested to report these symptoms to SMA Support.|
| 181039 |The IBM i LSAM Operator Replay function is improved with a few very small and uncommon fixes, such as adding field data that was missing from a display or a report.|
| 181040 |The IBM i LSAM server job name JORCMN could fail during the daily maintenance hour if the daily backup file has no unprocessed control records to carry forward to the next day. A CPYF command could fail on error CPF2817. This non-critical error is now prevented with a simple MONMSG command added to the sub-program JORLOGMNTC.|
| 181041 |The IBM i LSAM Dynamic Variables get three bugs fixed:  (1) *DATE formatting options not displayed after update to *ISO options; (2) Option 5=Display might report error messages as if in Change mode; (3) reformatting of some *DATE pairs was not working for 1-digit month.|
| 181042 |The IBM i LSAM Dynamic Variables were producing an incorrect conversion from *MDY to *ISO if the MDY data value had a leading space instead of a zero for the month value. IBM date manipulation APIs always require two digits for any two-digit part of a date or time, so the LSAM Dynamic Variables *DATE functions are now updated to edit and fill those date or time component fields, eliminating errors on human-readable date or time values.|
| 181043 |The IBM i LSAM Dynamic Variables and Message Management get three fixes: (1) Correct Message data capture with negative offset; (2) Correct cursor position in list of Message Management Parameters; (3) Prevent a false error when copying a Dynamic Variable and the copy includes the original variable token.|
| 181044 |The IBM i LSAM Captured Data Response Rules engine was providing an incorrect value for the $IBM JOB ID variables (including the whole ID and the individual parts:  NAME, USER and NUMBER).|
| 181046 |The IBM i LSAM SMA File Transfer server program SMAFTSR01 would sometimes fail with error code RNQ0103 due to incorrect management of the buffers of data being prepared for transmission.|
| 181048 |The IBM i LSAM SMA Job Scheduler server program was corrected to properly support an optional USRNAME( ) parameter that may be added to the Script command line in an OpCon IBM i Operator Replay job master record.  The Multi-Step Job Script Step maintenance screen was corrected to show an underline at the Step Status input field, matching the rest of the display and making this important flag more visible.|
| 181049 |The IBM i LSAM File Arrival job command for IFS file searches has its search sub-program changed to force output to STDOUT when a QSHELL environment would otherwise default to NONE (no output).|
| 181050 |The IBM i LSAM SCANOUTQ command was sometimes failing to send correct parameters to the SCANSPLF command, causing qualified spool files to be skipped.  Also, the Captured Data Log File display for SCANSPLF activity is updated to prevent incorrect spool file profile data from being reported.|
| 181052 |Cosmetic changes are made to correctly display field prompts in the IBM i LSAM Date Export/Import process prompting screen formats.  The Operator Replay Script ADD function now inserts a default value of “*JOB” in the User name field, which is the recommended new standard for improved flexibility when sub-scripts are used.|
| 181057 |The IBM i LSAM data translation testing command LSATBLTEST would cause the LSAM Job Scheduler communications program (CMNSKTR00) to fail with error CPF2498 whenever the test data translated to all blanks.  SMA recommends enclosing test data between simple characters such as the digits 0 – 9.  The fixed LSAM Job Scheduler will now send Detail Job Messages whenever the test data might have caused a failure, along with a failed job status.|
| 181058 |The IBM i LSAM data translation testing command LSATBLTEST was not supported for certain single character translation tests, in case the ASCII source character might translate to an EBCDIC space character.  This fix changes the calculation of the length of the test data to rely entirely on the size between the two test data enclosure characters.|
| 181059 |This PTF includes fixes for the SMASETUP command used to install or upgrade the IBM i LSAM agent at/to version 18.1.  Some of the utility commands can also be used after the agent is installed, so these changes are now added to the LSAM programs library. Most of the fixes pertain to clients who are still using the IBM i QGPL library to hold some LSAM convenience commands and the LSAM environment definition files.|
| 181060 |This PTF makes changes to LSAM program objects located in the SMAGPL library.  The LSAM menu entry splash display has been updated to show the LSAM Environment Description text.  There is also a redistribution of program SMADTAARAC that is part of the LSAINIT command used to initialize most settings in a non-default LSAM Environment.  Some limited sites did not receive this program update during the beta site testing cycle of LSAM version 18.1.|
| 181061 |This PTF corrects logic in the LSAM PTF installation program for updating the LSAM PTF Level data area when the QGPL library is being used to hold some of the LSAM convenience utilities.|
| 181064 |The IBM i LSAM Message Management Parameters maintenance program would issue error MCH1202 (decimal data error) while in F6=Add mode when F13 was pressed.|
| 181065 |The IBM i LSAM Message Management maintenance program was failing to show error or status messages from the initial list display.|
| 181068 |The IBM i LSAM Submitted Job Log viewer program added by PTF # 181063 was failing when F18=Bottom was pressed from the initial list display.  The PageUp key was also sometimes not working.|
| 181070, 181071 |The IBM i LSAM installation libraries had two errors in controlling the location of certain LSAM internal utility programs.  These PTFs update the LSAM Object Authority (and Location) control file, and they correct the location of the programs.|
| 181072 |The IBM i LSAM PTF install programs could fail if an LSAM PTF was rolled back, and then later, as that PTF was re-applied, any other new LSAM PTFs are also ready for application.  The PTF install program tried to use the Re-Apply program logic for the new PTFs, and that would fail.  The failure occurs before any new PTF is applied, so the recovery is simply to restart the LSAM PTF install process.  However, this will not normally occur at any live client site, except for an SMA partner participating in an LSAM Beta site test.  Otherwise, this error occurs only within the SMA Development and Testing departments when PTFs are often rolled back and reapplied.  **RECOVERY NOTE:**  For any LSAM environments where this error has occurred, SMA recommends downloading the latest LSAM PTFs, including the most current version of the LSCTLDTA save file, and also the special LSAM Partial PTF save file named LSCUMPT.072.  When starting the LSAM PTF process, be sure to press the Enter key a second time and update the name of the partial PTF save file to “LSCUMPTF.072”.  This will apply only the one PTF.  It may be applied out of sequence.  After that, the LSAM will behave normally during a multi-PTF installation process, including Re-Applying followed by any new LSAM PTFs.  Thus, after the single PTF has been applied, a normal cumulative PTF install process may be used to catch up to the latest PTF levels.|
| 181073 |The IBM i LSAM utility for auditing and rectifying a cloned LSAM environment, command LSAINIT, has its command driver program and display format updated to correctly manage the SMA File Transfer port number.  Also, the values prompting screen now supports a separate field for the SMA File Transfer IP address.|
| 181074 |The IBM i LSAM communication programs for SMA File Transfer have their log entries revised to more accurately report the IP address being used whenever there are internal VLAN IP addresses engaged within a virtual IBM i partition.  This fix does not affect logging for most clients who are using IP addresses that are accessible from outside of physical IBM i partitions.|
| 181075 |The IBM i LSAM new log viewer program for the LSAM Submitted Job Log (sub-menu 6, option 5, log viewer 4) needed fixes for the Content Search function to find all matches and to avoid a potential program failure.|
| 181076 |The IBM i LSAM data import display of a batch control record was showing an incorrect value for the Target Partition.  The controls were correct in the file.  Only the display was incorrect.|
| 181077 |The IBM i LSAM uses a value of ‘N’ in the LSAM Job Status Master log file as it is building a new job start request.  If an OpCon job status request arrives during this state, the value of ‘N’ was being sent back to OpCon, but this is not a valid numeric job status, so the OpCon SAM.log was showing error messages.  This fix translates any ‘N’ value to a zero value being sent back to the OpCon server, which is a valid way to indicate that the job has not started yet, and so it is not yet found.|
| 181078 |The IBM i LSAM Agent for SMA File Transfer jobs was sometimes reporting that a normally completed file transfer had ended in error.  There was a mistake in program logic that caused the Agent to believe it had not yet received a valid end-of-job transaction (with a transaction ID of 029).|
| 181079 |The IBM i LSAM logging management function, which is option 4 in the LSAM sub-menu 6, did not provide a separate End Logging control for the Job Scheduler “trace logging” option.  Therefore, when an operator requested to stop the verbose trace logging, that was causing all Job Scheduler logging to stop.  This fix implements a separate parameter on the LSAM ENDLOGCMD command, which executes the requests entered by an operator on the log management display.  Now the ENDLOGCMD has the same separate log function management options as were already showing in the STRLOGCMD utility command, and the trace logging can be ended separately without disabling all Job Scheduler logging.|
| 181080 |The LSAM data Import command (LSAIMPDTA) was incorrectly reporting error OPR0046 when the value for the Import save file was left set to *DEAULT.  This fix accepts the Import control record value for the save file name, as expected for *DEFAULT.|
| 181083 |File arrival jobs will delete temporary libraries when KEEPWRKLIB is set to 'N' even when the job reports a failure code.|
| 181084 |When adding data export control using F4 to prompt for the group code, option 8 was not returning the value of MLTJOB.|
| 181089 |The IBM i LSAM Job Scheduler server program is fixed to properly manage the Library name for a Job Description and a Job Queue.  Previously, this program failed to substitute the LSAM Parameters default library name whenever the Library fields were left set to the default value of asterisk (*).|
| 181098 |The IBM i LSAM Job Scheduler server program is fixed to prevent a rejection of a job start request whenever the OpCon job master record has an object name typed into the Job Queue Name field, but the Job Queue Library field was left set to the default value of (*) asterisk.  After this fix, the server resumes its previous behavior of inserting (*LIBL) into the library name.|
| 181099 |Prevent lost SCANSPLF commands for OpCon Job. In rare circumstances, the LSAM daily file purging program could delete LSAM Job Master Auxiliary records for jobs that were still active, causing the control data for a job-related SCANSPLF command to be lost.  This prevented job completion in OpCon.|
| 181100 |The IBM i LSAM Multi-Step Job Script driver program fails if a Step Sequence Number is greater than 999.  This bug was introduced by the loop prevention enhancement added with PTF # 181069.|
| 181101 |SMARGZ does not reorganize LSAJOBF00: The LSAM database reorganize command and programs were preventing reorganization of the LSAM Job Master log file because Save-While-Active save of library SMADTA left persistent file object locks.  The SAVLIB operation is moved to after the RGZPFM commands.  The LSAM program LSAENDR00 that is supposed to end all LSAM server jobs was failing to seton *INLR, that is, the program was never closed and so file LSAJOBF00 was left open, preventing an exclusive lock and the RGZPFM command from executing.|
| 181102 |The tracking of total bytes transferred during a SMA File Transfer job was causing a failure of either SMAFTSR01 and/or SMAFTAR01, whenever a very large file (any size over 8 GB) was being transferred.  This was due to a math error that is fixed.|
| 181104 |Restore *DIR (directory) check not found error code. The CHKIFSFIL command may be used directly, but it also supports the IBM i File Arrival job sub-type in the OpCon user interface.  When it was adapted to for use with File Arrival jobs, the response code for a *DIR not found was changed incorrectly.|
| 181105 |JORS reports duplicate QPJOBLOG reports. This LSAM's JORS service was reporting a duplicate report listing for the final QPJOBLOG report, after the enhancement that optionally also supports IBM i generated diagnostic report files (QPPGMDMP and QPDSPJOB) via PTF # 181103.|
| 181108 |The LSAM server job LSAJOR failed due to a record lock held by the sub-job JORCMNSUB. A record lock held by JORSMNSUB jobs (while they are still active) can cause the LSAM server job LSAJOR to fail.  This PTF removes the cause of an unresolved file lock in the JORCMNSUB jobs (program JORCMNR01).  Bug occurred in very busy systems.|
